<div class="form-container">
  <h2>Crear Nuevo Evento</h2>
  <form #form="ngForm" class="evento-form">

    <!-- Nombre del Evento -->
    <mat-form-field appearance="outline" class="form-group">
      <mat-label>Nombre del Evento</mat-label>
      <input matInput [(ngModel)]="evento.nombre" name="nombre" required>
      <mat-error *ngIf="formEvento.get('nombre')?.hasError('required')">
        El nombre del evento es requerido
      </mat-error>
    </mat-form-field>

    <div *ngIf="evento.imagen==='' || evento.imagen==null" class="drag-drop-area" (dragover)="onDragOver($event)" (drop)="onDrop($event)">
      <p>Arrastra y suelta una imagen o video aquí, o selecciona uno desde tus archivos.</p>
      <input type="file" id="archivo" (change)="onFileSelect($event)" hidden #fileInput>
      <button type="button" (click)="fileInput.click()">Seleccionar archivo</button>
    </div>
    <div *ngIf="formatoValido && evento.imagen!='' && evento.imagen!=null" class="vista-previa-contenedor">
      <img [src]="evento.imagen" alt="Vista previa de la imagen" class="vista-previa-imagen">
      <button type="button" (click)="eliminarArchivo()" class="btn btn-danger mt-2">Eliminar archivo</button>
    </div>




    <!-- Fecha y Hora del Evento -->
    <mat-form-field appearance="outline" class="form-group">
      <mat-label>Fecha y Hora del Evento</mat-label>
      <input matInput type="datetime-local" id="fechaHora" [(ngModel)]="evento.fechaHora" name="fechaHora"
        [min]="minFechaHora" required>
      <mat-error *ngIf="formEvento.get('fechaHora')?.hasError('required')">
        La fecha y hora del evento son requeridas
      </mat-error>
      <mat-error *ngIf="formEvento.get('fechaHora')?.hasError('invalidDate')">
        La fecha debe ser mayor a hoy
      </mat-error>
    </mat-form-field>

    <!-- Descripción -->
    <mat-form-field appearance="outline" class="form-group">
      <mat-label>Descripción</mat-label>
      <input matInput [(ngModel)]="evento.descripcion" name="descripcion">
    </mat-form-field>

    <!-- Cantidad Máxima de Participantes -->
    <mat-form-field appearance="outline" class="form-group">
      <mat-label>Cantidad Máxima de Participantes</mat-label>
      <input matInput type="number" min="1" [(ngModel)]="evento.cantidadMaximaParticipantes"
        name="cantidadMaximaParticipantes" required>
      <mat-error *ngIf="formEvento.get('cantidadMaximaParticipantes')?.hasError('required')">
        La cantidad máxima de participantes es requerida y debe ser un número positivo
      </mat-error>
    </mat-form-field>

    <!-- Buscar Etiquetas -->
    <mat-form-field appearance="outline" class="form-group">
      <mat-label>Buscar Etiquetas:</mat-label>
      <input matInput id="etiquetas" [(ngModel)]="etiquetaSeleccionada" [ngbTypeahead]="searchEtiqueta"
        [resultFormatter]="resultFormatEtiqueta" [inputFormatter]="inputFormatEtiqueta"
        (selectItem)="agregarEtiqueta($event)" name="etiquetaSeleccionada" placeholder="Buscar etiqueta" />
      <mat-error
        *ngIf="formEvento.get('etiquetasSeleccionadas')?.hasError('sinEtiqueta') && formEvento.get('etiquetasSeleccionadas')?.touched">
        Al menos una etiqueta es requerida
      </mat-error>
    </mat-form-field>

    <div class="selected-tags">
      <span *ngFor="let etiqueta of etiquetasSeleccionadas" class="tag">
        {{ etiqueta.nombre }}
        <button (click)="eliminarEtiqueta(etiqueta)" class="remove-tag">
          &times;
        </button>
      </span>
    </div>

    <!-- Sección de búsqueda de direcciones y mapa -->
    <div class="mapa-container">
      <mat-form-field appearance="outline" class="form-group">
        <mat-label>Ubicación del Evento</mat-label>
        <input matInput type="text" class="form-control" placeholder="Ingresa una dirección"
          (input)="buscarDireccion($event)" />
        <ul *ngIf="sugerencias.length > 0" class="list-group">
          <li *ngFor="let sugerencia of sugerencias" (click)="seleccionarDireccion(sugerencia)"
            class="list-group-item list-group-item-action" style="cursor: pointer;">
            {{ sugerencia.direccion }} - {{ sugerencia.altura }}, {{ sugerencia.ciudad }}, {{ sugerencia.pais }}
          </li>
        </ul>
      </mat-form-field>

      <div class="form-group">
        <div id="map"></div>
      </div>

    </div>

    <!-- Botones -->
    <div class="form-buttons">
      <button mat-raised-button color="primary" type="button" (click)="saveEvento()" [disabled]="!isFormValid()">Guardar
        Evento</button>
      <button mat-flat-button color="accent" type="button" (click)="cancel()">Cancelar</button>
    </div>
  </form>
</div>