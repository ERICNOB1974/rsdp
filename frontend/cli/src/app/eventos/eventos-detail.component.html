<div class="container evento-detail-container" *ngIf="evento">
  <div class="row justify-content-center">
    <div class="card shadow-sm mt-4">
      <div class="card-body">
        <h2 class="card-title text-center mb-4">{{ evento.nombre }}</h2>
        <div *ngIf="evento.imagen && evento.imagen.startsWith('data:image')">
          <img [src]="evento.imagen" style="max-width: 400px; max-height: 400px;">
        </div>
        <div *ngIf="!evento.imagen" class="align-items-center">
          <img src="../../assets/evento.webp" style="max-width: 400px; max-height: 400px; ">
        </div>
        <p><strong>Fecha de creación:</strong> {{ evento.fechaDeCreacion | date:'dd-MM-yyyy' : '+00:00'}}</p>
        <p><strong>Fecha y hora:</strong> {{ evento.fechaHora | date:'short' }}</p>
        <p><strong>Ubicación:</strong> {{ evento.ubicacion }}</p>
        <p><strong>Descripción:</strong> {{ evento.descripcion }}</p>
        <p><strong>Cantidad máxima de participantes:</strong> {{ evento.cantidadMaximaParticipantes }}</p>

        <!-- Botón Inscribirse o Desinscribirse centrado -->
        <button class="btn btn-primary btn-block ingresar-button mx-auto"
          [disabled]="!(inscribirseValid() || salirValid()) || isLoading"
          (click)="salirValid() ? salir() : inscribirse()">
          {{ salirValid() ? 'Desinscribirse' : 'Inscribirse' }}
        </button>

        <!-- Botón de regresar centrado -->

        <!-- Botón Invitar Amigos centrado, visible solo si el usuario ya está inscrito -->
        <button *ngIf="botonInvitar() || creador" (click)="abrirModalInvitarAmigos()" class="btn btn-success btn-block mx-auto mt-3">
          Invitar amigos
        </button>

        <button *ngIf="creador" class="btn btn-warning btn-block mx-auto mt-3" (click)="openModal(modalNotificacion)">
          Notificar a todos los usuarios
        </button>


        <h3>Miembros</h3>
        <div *ngFor="let miembro of participantesVisibles">
          <!-- Si no es anónimo, muestra el perfil -->
          <div *ngIf="!miembro.anonimos">
            <img [src]="miembro.fotoPerfil" alt="{{ miembro.nombreUsuario }}" class="perfil-imagen">
            <span>{{ miembro.nombreUsuario }}</span>
            <button *ngIf="creador && miembro.id !== idUsuarioAutenticado"
              (click)="eliminarMiembro(miembro.id)">Eliminar Miembro</button>
          </div>
        </div>
        <!-- Mostrar la cantidad de usuarios anónimos -->
        <div *ngIf="usuariosAnonimos > 0">
          <span>{{ usuariosAnonimos }} Usuario{{ usuariosAnonimos > 1 ? 's' : '' }} anónimo{{ usuariosAnonimos > 1 ? 's'
            : '' }}</span>
        </div>

        <button *ngIf="creador" class="btn btn-primary" (click)="editarEvento()">Editar</button>
        <button *ngIf="creador" (click)="eliminarEvento()" class="btn btn-danger">Eliminar evento</button>
        <div *ngIf="isLoading" class="d-flex justify-content-center mt-3">
          <mat-progress-spinner mode="indeterminate" diameter="50" color="primary">
          </mat-progress-spinner>
        </div>
        <!-- 
  <div *ngIf="isLoading" aria-label="Orange and tan hamster running in a metal wheel" role="img"
  class="wheel-and-hamster">
  <div class="wheel"></div>
  <div class="hamster">
    <div class="hamster__body">
      <div class="hamster__head">
        <div class="hamster__ear"></div>
        <div class="hamster__eye"></div>
        <div class="hamster__nose"></div>
      </div>
      <div class="hamster__limb hamster__limb--fr"></div>
      <div class="hamster__limb hamster__limb--fl"></div>
      <div class="hamster__limb hamster__limb--br"></div>
      <div class="hamster__limb hamster__limb--bl"></div>
      <div class="hamster__tail"></div>
    </div>
  </div>
  <div class="spoke"></div>
</div>
-->

        <button (click)="goBack()" class="btn btn-secondary btn-block mt-2">Volver</button>

      </div>
    </div>
  </div>
</div>




<ng-template #modalNotificacion>
  <div class="modal" 
       id="notificacionModal" 
       tabindex="-1" 
       aria-labelledby="notificacionModalLabel" 
       aria-hidden="true" 
       role="dialog">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content bg-dark-custom text-light">
        <div class="modal-header border-bottom border-secondary">
          <h5 class="modal-title text-highlight" id="notificacionModalLabel">Enviar notificación a los miembros del evento</h5>
          <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="closeModal()"></button>
        </div>
        <div class="modal-body">
          <form #notificacionForm="ngForm" class="p-3">
            <div class="mb-3">
              <label for="motivo" class="form-label text-light">Motivo de la notificación</label>
              <input 
                type="text" 
                class="form-control border-secondary bg-dark-input text-light" 
                id="motivo" 
                [(ngModel)]="motivo" 
                name="motivo" 
                placeholder="Escribe el motivo"
                required>
              <div *ngIf="!motivo && notificacionForm.submitted" class="text-danger mt-1">
                El motivo es obligatorio.
              </div>
            </div>
            <div class="mb-3">
              <label for="mensaje" class="form-label text-light">Mensaje</label>
              <textarea 
                class="form-control border-secondary bg-dark-input text-light" 
                id="mensaje" 
                [(ngModel)]="mensaje" 
                name="mensaje" 
                rows="4" 
                placeholder="Escribe el mensaje"
                required>
              </textarea>
              <div *ngIf="!mensaje && notificacionForm.submitted" class="text-danger mt-1">
                El mensaje es obligatorio.
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer border-top border-secondary d-flex justify-content-between">
          <button 
            type="button" 
            class="btn btn-cancel" 
            (click)="closeModal()">Cancelar</button>
          <button 
            type="button" 
            class="btn btn-primary btn-highlight" 
            [disabled]="!motivo || !mensaje" 
            (click)="enviarNotificacion()">Enviar</button>
        </div>
      </div>
    </div>
  </div>
</ng-template>