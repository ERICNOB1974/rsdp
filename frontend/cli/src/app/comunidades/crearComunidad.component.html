<div class="form-container">
    <h2>Crear Nueva Comunidad</h2>

    <form #form="ngForm">

        <mat-form-field appearance="outline" class="form-group">
            <mat-label>Nombre de la comunidad</mat-label>
            <input matInput [(ngModel)]="comunidad.nombre" name="nombre" required>
            <mat-error *ngIf="formComunidad.get('nombre')?.hasError('required')">
                El nombre de la comunidad es requerido
            </mat-error>
        </mat-form-field>


        <div *ngIf="comunidad.imagen==='' || comunidad.imagen==null" class="drag-drop-area"
            (dragover)="onDragOver($event)" (drop)="onDrop($event)">
            <p>Arrastra y suelta una imagen o video aquí, o selecciona uno desde tus archivos.</p>
            <input type="file" id="archivo" (change)="onFileSelect($event)" hidden #fileInput>
            <button type="button" (click)="fileInput.click()">Seleccionar archivo</button>
        </div>
        <div *ngIf="formatoValido && comunidad.imagen!='' && comunidad.imagen!=null" class="vista-previa-contenedor">
            <img [src]="comunidad.imagen" alt="Vista previa de la imagen" class="vista-previa-imagen">
            <button type="button" (click)="eliminarArchivo()" class="btn btn-danger mt-2">Eliminar archivo</button>
        </div>

        <div class="form-group">
            <label for="descripcion">Descripción</label>
            <textarea id="descripcion" [(ngModel)]="comunidad.descripcion" name="descripcion"></textarea>
        </div>

    

        <!-- Cantidad Máxima de Participantes -->
        <mat-form-field appearance="outline" class="form-group">
            <mat-label>Cantidad Máxima de Participantes</mat-label>
            <input matInput type="number" min="1" [(ngModel)]="comunidad.cantidadMaximaMiembros"
                name="cantidadMaximaParticipantes" required>
            <mat-error *ngIf="formComunidad.get('cantidadMaximaParticipantes')?.hasError('required')">
                La cantidad máxima de participantes es requerida y debe ser un número positivo
            </mat-error>
        </mat-form-field>

        <div class="form-group">
            <label for="etiquetas">Buscar Etiquetas:</label>
            <input id="etiquetas" class="form-control" [(ngModel)]="etiquetaSeleccionada"
                [ngbTypeahead]="searchEtiqueta" [resultFormatter]="resultFormatEtiqueta"
                [inputFormatter]="inputFormatEtiqueta" (selectItem)="agregarEtiqueta($event)"
                name="etiquetaSeleccionada" placeholder="Buscar etiqueta" />
        </div>

        <div class="selected-tags">
            <span *ngFor="let etiqueta of etiquetasSeleccionadas" class="tag">
                {{ etiqueta.nombre }}
                <button (click)="eliminarEtiqueta(etiqueta)" class="remove-tag">
                    &times;
                </button>
            </span>
        </div>


        <div class="mapa-container">
            <div class="input-container">
                <input type="text" class="form-control" placeholder="Ingresa una dirección"
                    (input)="buscarDireccion($event)" />

                <ul *ngIf="sugerencias.length > 0" class="list-group">
                    <li *ngFor="let sugerencia of sugerencias" (click)="seleccionarDireccion(sugerencia)"
                        class="list-group-item list-group-item-action" style="cursor: pointer;">
                        {{ sugerencia.direccion }} - {{ sugerencia.altura }}, {{ sugerencia.ciudad }}, {{
                        sugerencia.pais }}
                    </li>
                </ul>
            </div>

            <!-- Aquí se mostrará el mapa -->
            <div id="map"></div>
        </div>

        <div class="form-group">
            <label class="padding-top-20">
                <input type="checkbox" [(ngModel)]="comunidad.esPrivada" name="esPrivada">
                ¿La Comunidad es privada?
            </label>
        </div>


        <div class="form-buttons">
            <button type="submit" (click)="saveComunidad()" [disabled]="!isFormValid()" class="btn btn-primary">Guardar
                comunidad</button>
            <button type="button" (click)="cancel()" class="btn btn-secondary">Cancelar</button>
        </div>
    </form>
    <!-- Mensaje de confirmación o error -->
    <div *ngIf="showMessage" class="alert alert-info">
        {{ messageToShow }}
    </div>
</div>