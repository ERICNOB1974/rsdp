<div class="form-container">
  <h2>Editar Comunidad</h2>
  <form [formGroup]="formComunidad" (ngSubmit)="guardarCambios()">

    <mat-form-field appearance="outline" class="form-group">
      <mat-label>Nombre de la comunidad</mat-label>
      <input matInput name="nombre" formControlName="nombre" required [(ngModel)]="comunidad.nombre">
      <mat-error *ngIf="formComunidad.get('nombre')?.hasError('required')">
        El nombre de la comunidad es requerido
      </mat-error>
    </mat-form-field>


    
    <div 
    *ngIf="comunidad.imagen === '' || comunidad.imagen == null" 
    class="drag-drop-area" 
    (dragover)="onDragOver($event)" 
    (drop)="onDrop($event)"
  >
      <p>Arrastra y suelta una imagen o video aquí, o selecciona uno desde tus archivos.</p>
      <input type="file" id="archivo" (change)="onFileSelect($event)" hidden #fileInput>
      <button type="button" (click)="fileInput.click()">Seleccionar archivo</button>
    </div>
    <div *ngIf="formatoValido && comunidad.imagen!='' && comunidad.imagen!=null"  class="drag-drop-area">
      <img [src]="comunidad.imagen" alt="Vista previa de la imagen" class="vista-previa-imagen">
      <button type="button" (click)="eliminarArchivo()" class="btn btn-danger mt-2">Eliminar archivo</button>
    </div>

    <mat-form-field appearance="outline" class="form-group">
      <mat-label>Descripción</mat-label>
      <input matInput [(ngModel)]="comunidad.descripcion" name="descripcion">
    </mat-form-field>

    <mat-form-field appearance="outline" class="form-group">
      <mat-label>Cantidad Máxima de Participantes</mat-label>
      <input matInput type="number" min="1" name="cantidadMaximaMiembros" required
        formControlName="cantidadMaximaMiembros" [(ngModel)]="comunidad.cantidadMaximaMiembros">
      <mat-error *ngIf="formComunidad.get('cantidadMaximaMiembros')?.hasError('required')">
        La cantidad máxima de participantes es requerida y debe ser un número positivo
      </mat-error>
    </mat-form-field>


    <mat-form-field appearance="outline" class="form-group">
      <mat-label>Buscar Etiquetas:</mat-label>
      <input matInput id="etiquetas" [ngbTypeahead]="searchEtiqueta" [resultFormatter]="resultFormatEtiqueta"
        [inputFormatter]="inputFormatEtiqueta" (selectItem)="agregarEtiqueta($event)" name="etiquetaSeleccionada"
        placeholder="Buscar etiqueta" [(ngModel)]="etiquetaSeleccionada" />
      <footer *ngIf="etiquetasSeleccionadas.length==0" class="mat-error-custom">
        Al menos una etiqueta es requerida
      </footer>
    </mat-form-field>


    <div class="selected-tags">
      <span *ngFor="let etiqueta of etiquetasSeleccionadas" class="tag">
        {{ etiqueta.nombre }}
        <button (click)="eliminarEtiqueta(etiqueta)" class="remove-tag">
          &times;
        </button>
      </span>
    </div>

    <div class="form-group checkbox-group">
      <label for="esPrivada">¿Es Privada?</label>
      <input type="checkbox" id="esPrivada" [(ngModel)]="comunidad.esPrivada" name="esPrivada">
    </div>

    <div class="button-group">
      <button type="submit" class="btn btn-primary">Actualizar Comunidad</button>
      <button type="button" class="btn btn-secondary" (click)="cancelar()">Cancelar</button>
    </div>

  </form>
</div>